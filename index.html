<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<style>
    *{
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }
    #game-board{
        position: relative;
        width: 500px;
        height: 500px;
        margin: auto;
        margin-top: 100px;
        border: 1px inset black;
    }
    :root{
        --cell-size: 20px;
    }
    #food{
        position: absolute;
        /* default params */
        height: var(--cell-size);
        width: var(--cell-size);
        background-color: red;

        /* temporary */
        right: 0;
    }
    #snake > div{
        position: absolute;
        height: var(--cell-size);
        width: var(--cell-size);
        background-color: limegreen;
        
        /* transition: all 0.4s; */
    }   
    .cells-animated{
        transition: all 0.4s;
    }
</style>
<body>
        <button id="update">toggle animation</button>
        <div id="game-board">
            <div id="snake">
                <!-- <div id="snake-head"></div> -->
            </div>
            <!-- <div id="food"></div> -->
        </div>
</body>
<script>
    class Config{
        constructor(){
            this.boardSize = 500;
            this.cellSize = 20;
            this.snakeDirection = 'right';
            this.speed = 2000000;
            // snakeColor
            this.foodPos;
            this.foodDiv;

            this.snakeDiv = document.getElementById('snake');
            this.snakeHeadDiv; //position of nth child div in #snake
            this.snakeTailDiv; //position of nth child div on #snake

            this.snakeLength = 3; //can not be set less, 3 is minimum //or it can be less :D
            this.snakeTrail = [];
            // this.snake = document.getElementById('snake-head')
            // this.food = document.getElementById('food');
        }
    }
    class Snake extends Config{
        snakeExpand(){
            //add new coordinate to array
            this.snakeTrail.unshift(this.snakeTrail[0]);

            // and new div to represent new cell
            let snakeCell = document.createElement('div');
            this.snakeDiv.appendChild(snakeCell);

            snakeCell.style.left = this.snakeTrail[0].cellX;
            snakeCell.style.top = this.snakeTrail[0].cellY;

            this.snakeLength++;
            // this.snakeTailDiv = 1;
        }
        snakeTrim(){

        }

        moveSnake(direction){
            let newPos;

            //calculate new position
            switch(direction){
                case 'left':
                    newPos = { 
                        "cellX": this.snakeTrail[this.snakeTrail.length-1].cellX - this.cellSize,
                        "cellY": this.snakeTrail[this.snakeTrail.length-1].cellY 
                    }
                break;
                case 'right':
                    newPos = { 
                        "cellX": this.snakeTrail[this.snakeTrail.length-1].cellX + this.cellSize,
                        "cellY": this.snakeTrail[this.snakeTrail.length-1].cellY 
                    }
                break;
                case 'top':
                    newPos = { 
                        "cellX": this.snakeTrail[this.snakeTrail.length-1].cellX,
                        "cellY": this.snakeTrail[this.snakeTrail.length-1].cellY - this.cellSize 
                    }
                break;
                case 'down':
                    newPos = { 
                        "cellX": this.snakeTrail[this.snakeTrail.length-1].cellX,
                        "cellY": this.snakeTrail[this.snakeTrail.length-1].cellY + this.cellSize
                    }
                break;
            }

            //checks all snake cells if newPos matches snake tail cell
            for(let i = 0; i < this.snakeTrail.length-3; i++){
                if( this.snakeTrail[i] === newPos){
                    //pause game
                    //or eat tail and coninue playing, sounds more fun
                }
            }
            //checks if snake hit the foodCell
            if(this.foodPos.cellX === newPos.cellX & this.foodPos.cellY === newPos.cellY){
                this.spawn('food');
                this.snakeExpand();                
                //Points++
            }
            //check if newPos goes out of boundary
            if(newPos.cellX >= this.boardSize){
                newPos.cellX -= this.boardSize;
            }
            if(newPos.cellX < 0){
                console.log(newPos.cellX);
                newPos.cellX = 500 + newPos.cellX; //"+" because cellX is now negative number;
            }
            if(newPos.cellY >= this.boardSize){
                newPos.cellY -= this.boardSize;
            }
            if(newPos.cellY < 0){
                console.log(newPos.cellY);
                newPos.cellY = 500 + newPos.cellY; //"+" because cellY is now negative number;
            }

            //moving snake //Method:3
            // somehow get last cell div and set its positions to newPos.x and y
            let tail = document.querySelector(`#snake > div:nth-child(${this.snakeTailDiv})`);
            tail.style.left = newPos.cellX;
            tail.style.top = newPos.cellY;

            //update head and tail div tracking
            this.snakeHeadDiv = this.snakeTailDiv;
            if(this.snakeTailDiv === this.snakeLength){
                this.snakeTailDiv = 1;
            }else{
                this.snakeTailDiv++;
            }; 

            //updating coordinates array
            this.snakeTrail.push(newPos)
            this.snakeTrail.shift()

            // console.log(`newPos: x:${newPos.cellX} y:${newPos.cellY}`)
            // console.log(`foodPos: x:${this.foodPos.cellX} y:${this.foodPos.cellY}`)
        }
        
        spawn(element){

            //generate random coords so food is inside the board and not on snake position
            //because of floor 500 will never be reached so foodX will be max 490
            let randX = Math.floor(Math.random()*this.boardSize); 
            let elementX = randX - randX%this.cellSize;

            let randY = Math.floor(Math.random()*this.boardSize);
            let elementY = randY - randY%this.cellSize;

            switch(element){
                case 'snake':

                    for(let i = 0; i < this.snakeLength; i++){
                        //filling snakeTrail with default snake length cells
                        this.snakeTrail.push(
                            { 
                                "cellX": elementX,
                                "cellY": elementY
                            }
                        )
                        //creating snake divCell
                        let snakeCell = document.createElement('div');
                        this.snakeDiv.appendChild(snakeCell);

                        //draw it
                        snakeCell.style.left = elementX;
                        snakeCell.style.top = elementY;
                    }

                    //save which child div is headCell and which child div is lastCell
                    //$$ values are based on 1...3 they dont match array numbering
                    this.snakeHeadDiv = this.snakeLength;
                    this.snakeTailDiv = 1;

                break;
                case 'food':

                    //if foodPos matches any snakeTrail position re generate random position and try again
                    

                    //creating food divCell if it doenot exist
                    if(this.foodDiv === undefined){
                        let food = document.createElement('div');
                        food.id = 'food';
                        document.getElementById('game-board').appendChild(food);
                        this.foodDiv = food;
                    }

                    //updating foodPos value
                    this.foodPos = { 
                        "cellX": elementX,
                        "cellY": elementY
                    }
                    //drawing food divCell
                    this.foodDiv.style.left = elementX;
                    this.foodDiv.style.top = elementY;
                break;
            }
        }

        updateGame(){
            // main function that will update game at every tick

            this.moveSnake(this.snakeDirection);
        }
    }
    
    const game = new Snake()
    game.spawn('food');
    game.spawn('snake');

    // let head = document.querySelector(`#snake > div:nth-child(${game.snakeHeadDiv})`)
    // let tail = document.querySelector(`#snake > div:nth-child(${game.snakeTailDiv})`)

    setInterval(() => {
        game.updateGame();
    }, game.speed);

    document.getElementById('update').addEventListener('click',(event)=>{
        [...document.querySelectorAll('#snake > div')].forEach((item)=>{
            item.classList.toggle('cells-animated');
        })
    })

    // event listeners change game.snakeDirection based on keys pressed
    document.addEventListener('keydown', (event)=>{
        switch(event.key){
            case 'ArrowLeft':
                game.moveSnake('left')
                game.snakeDirection = 'left';
            break;
            case 'ArrowRight':
                game.moveSnake('right')
                game.snakeDirection = 'right';
            break;
            case 'ArrowUp':
                game.moveSnake('top')
                game.snakeDirection = 'top';
            break;
            case 'ArrowDown':
                game.moveSnake('down')
                game.snakeDirection = 'down';
            break;
        };
    })
    
    
</script>
</html>