<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<style>
    *{
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }
    #game-board{
        position: relative;
        width: 500px;
        height: 500px;
        margin: auto;
        margin-top: 100px;
        border: 1px inset black;
    }
    :root{
        --cell-size: 20px;
    }
    #food{
        position: absolute;
        /* default params */
        height: var(--cell-size);
        width: var(--cell-size);
        background-color: red;

        /* temporary */
        right: 0;

    }
    #snake > div{
        position: absolute;
        height: var(--cell-size);
        width: var(--cell-size);
        background-color: limegreen;
    }   
</style>
<body>
        <button id="update">Update Game</button>
        <div id="game-board">
            <div id="snake">
                <!-- <div id="snake-head"></div> -->
            </div>
            <!-- <div id="food"></div> -->
        </div>
</body>
<script>
    class Config{
        constructor(){
            this.boardSize = 500;
            this.cellSize = 20;
            this.snakeDirection = 'right';
            // snakeColor
            this.foodPos;
            this.snakeHeadDiv; //position of nth child div in #snake
            this.snakeTailDiv; //position of nth child div on #snake
            this.snakeLength = 3; //can not be set less, 3 is minimum //or it can be less :D
            this.snakeTrail = [];
            // this.snake = document.getElementById('snake-head')
            // this.food = document.getElementById('food');
        }
    }
    class Snake extends Config{

        moveSnake(direction){
            let newPos;

            //calculate new position
            switch(direction){
                case 'left':
                    newPos = { 
                        "cellX": this.snakeTrail[this.snakeTrail.length-1].cellX + this.cellSize,
                        "cellY": this.snakeTrail[this.snakeTrail.length-1].cellY 
                    }
                break;
                case 'right':
                    newPos = { 
                        "cellX": this.snakeTrail[this.snakeTrail.length-1].cellX - this.cellSize,
                        "cellY": this.snakeTrail[this.snakeTrail.length-1].cellY 
                    }
                break;
                case 'top':
                    newPos = { 
                        "cellX": this.snakeTrail[this.snakeTrail.length-1].cellX,
                        "cellY": this.snakeTrail[this.snakeTrail.length-1].cellY + this.cellSize 
                    }
                break;
                case 'down':
                    newPos = { 
                        "cellX": this.snakeTrail[this.snakeTrail.length-1].cellX,
                        "cellY": this.snakeTrail[this.snakeTrail.length-1].cellY + this.cellSize
                    }
                break;
            }

            //checking all snake cells if newPos matches snake tail cell
            for(let i = 0; i < this.snakeTrail.length-3; i++){
                if( this.snakeTrail[i] === newPos){
                    //pause game
                    //or eat tail and coninue playing, sounds more fun
                }
            }
            if(this.foodPos === newPos){
                //add new coordinate to array and new div to represent new cell
                //Points++
                //spawn(this.food);
            }
            //moving snake //Method:3
            // somehow get last cell div and set its positions to newPos.x and y
            let tail = document.querySelector(`#snake > div:nth-child(${this.snakeTailDiv})`);
            tail.style.left = newPos.cellX;
            tail.style.top = newPos.cellY;

            //update head and tail div tracking
            this.snakeHeadDiv = this.snakeTailDiv;
            if(this.snakeTailDiv === this.snakeLengt){
                this.snakeTailDiv = 1;
            }else{
                this.snakeTailDiv++;
            }; 

            //updating coordinates array
            this.snakeTrail.push(newPos)
            this.snakeTrail.shift()
        }
        
        spawn(element){

            //generate random coords so food is inside the board and not on snake position
            //because of floor 500 will never be reached so foodX will be max 490
            let randX = Math.floor(Math.random()*this.boardSize); 
            let elementX = randX - randX%this.cellSize;

            let randY = Math.floor(Math.random()*this.boardSize);
            let elementY = randY - randY%this.cellSize;

            switch(element){
                case 'snake':

                    for(let i = 0; i < this.snakeLength; i++){
                        //filling snakeTrail with default snake length cells
                        this.snakeTrail.push(
                            { 
                                "cellX": elementX,
                                "cellY": elementY
                            }
                        )
                        //creating snake divCell
                        let snakeCell = document.createElement('div');
                        document.getElementById('snake').appendChild(snakeCell);

                        //draw it
                        snakeCell.style.left = elementX;
                        snakeCell.style.top = elementY;
                    }

                    //save which child div is headCell and which child div is lastCell
                    //$$ values are based on 1...3 they dont match array numbering
                    this.snakeHeadDiv = this.snakeLength;
                    this.snakeTailDiv = 1;

                break;
                case 'food':
                    this.foodPos = { 
                        "cellX": elementX,
                        "cellY": elementY
                    }

                    //creating food divCell
                    let food = document.createElement('div');
                    food.id = 'food';
                    document.getElementById('game-board').appendChild(food);

                    //drawing food divCell
                    food.style.left = elementX;
                    food.style.top = elementY;
                break;
            }
        }

        updateGame(){
            // main function that will update game at every tick

            this.moveSnake(this.snakeDirection);
        }
    }
    
    const game = new Snake()
    game.spawn('food');
    game.spawn('snake');

    // let head = document.querySelector(`#snake > div:nth-child(${game.snakeHeadDiv})`)
    // let tail = document.querySelector(`#snake > div:nth-child(${game.snakeTailDiv})`)

    // setInterval(() => {
    //     game.updateGame();
    // }, 1000);
    document.getElementById('update').addEventListener('click',(event)=>{
        game.updateGame();
    })

    game.updateGame();
    // event listeners that will change game.snakeDirection based on keys pressed
    
</script>
</html>